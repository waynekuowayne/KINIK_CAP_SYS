# 系統部署說明

## 系統架構

本系統分為兩個部分：

1. **監控室電腦** - 負責資料彙整、顯示和管理
2. **生產機台電腦** - 負責拍照和狀態回報

---

## 一、監控室電腦部署

### 1.1 部署位置
- 放在監控室可以看到的電腦
- 需要連接到公司內部網路
- 可以被所有生產機台存取

### 1.2 需要的檔案

```
監控室部署包/
├── backend/
│   ├── simple_api.py          # FastAPI 後端 API
│   └── requirements.txt       # Python 套件清單
├── frontend/
│   ├── dist/                  # 前端編譯後的檔案 (需要先編譯)
│   └── (或整個 frontend 資料夾用於開發模式)
├── 啟動監控室系統.bat         # 一鍵啟動腳本
└── 部署說明_監控室.txt        # 部署步驟
```

### 1.3 安裝步驟

1. **安裝 Python 3.12**
   - 下載：https://www.python.org/downloads/
   - 安裝時勾選「Add Python to PATH」

2. **安裝 MySQL 資料庫**（如果還沒有）
   - 或連接到現有的 MySQL 伺服器

3. **安裝後端套件**
   ```
   cd backend
   pip install -r requirements.txt
   ```

4. **安裝前端環境**（開發模式）
   ```
   cd frontend
   npm install
   ```
   或使用編譯後的檔案（生產模式）

5. **修改資料庫連線設定**
   - 編輯 `backend/simple_api.py` 中的 DB_CONFIG
   - 填入正確的資料庫 IP、帳號、密碼

6. **啟動系統**
   - 執行 `啟動監控室系統.bat`
   - 開啟瀏覽器訪問 http://localhost:5173

### 1.4 網路設定

- 確保監控室電腦的 IP 是固定的（例如 192.168.1.100）
- 開放以下 port：
  - **8000** - 後端 API
  - **5173** - 前端網頁（開發模式）或 **80** (生產模式)
  - **3306** - MySQL 資料庫（如果資料庫在同一台）

---

## 二、生產機台電腦部署

### 2.1 部署位置
- 每一台生產機台電腦（CAM-001, CAM-002, ...）
- 需要連接到公司內部網路
- 可以存取監控室電腦的資料庫

### 2.2 需要的檔案

```
機台部署包/
├── registry_version/
│   ├── registry_sync.py       # Registry 同步服務
│   └── requirements.txt       # Python 套件清單
├── docs/
│   └── CameraTestApp_VS2017/  # VB.NET 拍照程式（或編譯好的 exe）
│       ├── TestForm.vb
│       ├── RegistryHelper.vb
│       └── ...
├── 機台設定/
│   ├── CAM-001.reg            # 機台編號設定檔（需要修改）
│   └── DatabaseConfig.reg     # 資料庫連線設定（需要修改）
├── 啟動機台同步服務.bat       # 一鍵啟動 Python 同步
└── 部署說明_機台.txt          # 部署步驟
```

### 2.3 安裝步驟

1. **安裝 Python 3.12**
   - 下載：https://www.python.org/downloads/
   - 安裝時勾選「Add Python to PATH」

2. **安裝 Python 套件**
   ```
   cd registry_version
   pip install -r requirements.txt
   ```

3. **修改機台設定檔**
   - 編輯 `機台設定/CAM-001.reg`（改成該機台的編號，例如 CAM-002）
   - 修改 MachineID、MachineName、MachineIP
   - 執行 .reg 檔案匯入設定

4. **修改資料庫連線設定**
   - 編輯 `機台設定/DatabaseConfig.reg`
   - 填入監控室電腦的 IP 位址（例如 192.168.1.100）
   - 執行 .reg 檔案匯入設定

5. **設定開機自動執行**
   - 將 `啟動機台同步服務.bat` 加入到 Windows 啟動資料夾
   - 路徑：`C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp`

6. **測試執行**
   - 執行 `啟動機台同步服務.bat`
   - 檢查 `C:\Temp\RegistrySync_Log.txt` 確認連線成功

### 2.4 VB.NET 程式部署

如果有編譯好的 exe：
- 複製到機台電腦
- 建立桌面捷徑
- 設定必要的權限

如果需要重新編譯：
- 需要 Visual Studio 2017
- 開啟專案後建置（Build）
- 發行（Publish）後部署

---

## 三、網路連線設定

### 3.1 監控室電腦（伺服器端）

假設監控室電腦 IP = `192.168.1.100`

**需要開放的 Port：**
- 8000 - 後端 API
- 3306 - MySQL 資料庫

**防火牆設定：**
```powershell
# 開放 8000 port
netsh advfirewall firewall add rule name="Backend API" dir=in action=allow protocol=TCP localport=8000

# 開放 3306 port
netsh advfirewall firewall add rule name="MySQL" dir=in action=allow protocol=TCP localport=3306
```

### 3.2 生產機台電腦（客戶端）

**需要連線的 IP：**
- 監控室電腦 IP（例如 192.168.1.100）

**測試連線：**
```cmd
# 測試能否連到監控室電腦
ping 192.168.1.100

# 測試能否連到後端 API
curl http://192.168.1.100:8000

# 測試能否連到資料庫
telnet 192.168.1.100 3306
```

---

## 四、設定檔範例

### 4.1 機台設定檔 (CAM-001.reg)

```reg
Windows Registry Editor Version 5.00

[HKEY_CURRENT_USER\Software\ZHAOI\VALUE\MachineConfig]
"MachineID"="CAM-001"
"MachineName"="拍照機-1"
"MachineIP"="192.168.1.101"
```

### 4.2 資料庫連線設定 (DatabaseConfig.reg)

```reg
Windows Registry Editor Version 5.00

[HKEY_CURRENT_USER\Software\ZHAOI\VALUE\DatabaseConfig]
"Server"="192.168.1.100"
"Port"=dword:0000a8e2
"Database"="db_camera"
"Username"="A999"
"Password"="1023"
```

---

## 五、部署檢查清單

### 監控室電腦
- [ ] Python 3.12 已安裝
- [ ] MySQL 資料庫已安裝並執行
- [ ] 後端套件已安裝 (FastAPI, pymysql)
- [ ] 前端已編譯或 Node.js 環境已安裝
- [ ] 防火牆 port 已開放 (8000, 3306)
- [ ] IP 位址已設定為固定 IP
- [ ] 啟動腳本可以正常執行

### 生產機台電腦
- [ ] Python 3.12 已安裝
- [ ] Python 套件已安裝 (pymysql)
- [ ] 機台設定檔已修改並匯入
- [ ] 資料庫連線設定已修改並匯入
- [ ] 可以 ping 到監控室電腦
- [ ] Python 同步服務可以連線到資料庫
- [ ] VB.NET 程式已部署
- [ ] 開機自動執行已設定

---

## 六、常見問題

### Q1: 機台無法連線到資料庫
**A:**
1. 確認監控室電腦防火牆是否開放 3306 port
2. 確認 MySQL 是否允許遠端連線
3. 確認資料庫帳號是否有權限從遠端連線

### Q2: 前端無法顯示機台資料
**A:**
1. 確認後端 API 是否正常運行（訪問 http://IP:8000）
2. 確認機台的 Python 同步服務是否運行
3. 檢查 `C:\Temp\RegistrySync_Log.txt` 查看錯誤訊息

### Q3: VB 程式啟動後狀態燈不變
**A:**
1. 確認 Registry 設定檔是否已匯入
2. 確認 Python 同步服務是否運行
3. 檢查 Python log 確認是否有連線錯誤

---

## 七、聯絡資訊

如有問題請聯絡系統管理員。
